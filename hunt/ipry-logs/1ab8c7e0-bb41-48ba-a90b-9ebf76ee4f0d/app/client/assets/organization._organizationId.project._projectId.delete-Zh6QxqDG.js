import{h as m}from"./chunk-WY5IRSCW-1dc6FieG.js";import{r as l}from"./chunk-OIYGIGL5-BYynBxW5.js";import{e as c,u as f,b as d,a as p,ad as h}from"./index-BnTlsbFl.js";import{p as u,r as I}from"./organization._organizationId.project.new-D3C_sj1w.js";import{i as j}from"./insomnia-fetch-B_XbrnGh.js";import{i as a}from"./invariant-DVddvGrP.js";import{g as w,c as y}from"./router-BoVIwh1i.js";async function E({params:n}){const{organizationId:t,projectId:i}=n;a(t,"Organization ID is required"),a(i,"Project ID is required");const e=await c.getById(i);a(e,"Project not found");const s=(await f.getOrCreate()).id;a(s,"User must be logged in to delete a project");try{await u.lock();const r=await d.bufferChanges();if(e.remoteId){const o=await j({path:`/v1/organizations/${t}/team-projects/${e.remoteId}`,method:"DELETE",sessionId:s});if(o&&"error"in o)return{error:o.error==="FORBIDDEN"?"You do not have permission to delete this project.":"An unexpected error occurred while deleting the project. Please try again."}}if(e.gitRepositoryId){const o=await p.getById(e.gitRepositoryId);o&&await p.remove(o)}await h.incrementDeletedRequestsForDescendents(e),await c.remove(e),await d.flushChanges(r),e.gitRepositoryId&&I(t,s);const g=await w({organizationId:t});return l(g)}catch(r){return console.log(r),{error:r instanceof Error?r.message:`An unexpected error occurred while deleting the project. Please try again. ${r}`}}finally{await u.unlock()}}const $=y(n=>({organizationId:t,projectId:i})=>{const e=m("/organization/:organizationId/project/:projectId/delete",{organizationId:t,projectId:i});return n({},{action:e,method:"POST"})});export{E as c,$ as u};
//# sourceMappingURL=organization._organizationId.project._projectId.delete-Zh6QxqDG.js.map
