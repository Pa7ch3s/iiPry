import{h}from"./chunk-WY5IRSCW-1dc6FieG.js";import{cD as g,c as l}from"./index-BnTlsbFl.js";import{ao as N}from"./index-wZAP8gf2.js";import{i as e}from"./invariant-DVddvGrP.js";import{c as _}from"./router-BoVIwh1i.js";async function w({params:i,request:n}){const{cloudCredentialId:r}=i;e(typeof r=="string","Credential ID is required");const t=await n.json(),{name:o,provider:a,credentials:s}=t;e(o&&typeof o=="string","Name is required"),e(a,"Cloud Provider name is required"),e(s,"Credentials are required");const p=await N({pluginName:g,actionName:"authenticate",params:{provider:a,credentials:s}}),{success:m,error:c,result:d}=p;if(c)return{error:`${c.errorMessage}`};if(m){const u=await l.getById(r);if(e(u,"No Cloud Credential found"),a==="hashicorp"){const{access_token:f,expires_at:C}=d;t.credentials.access_token=f,t.credentials.expires_at=C}return await l.update(u,t),d}return{error:"Unexpected response from "+a}}const P=_(i=>({cloudCredentialId:n,patch:r})=>i(JSON.stringify(r),{method:"POST",action:h("/cloud-credentials/:cloudCredentialId/update",{cloudCredentialId:n}),encType:"application/json"}));export{w as c,P as u};
//# sourceMappingURL=cloud-credentials._cloudCredentialId.update-RaJlpXVy.js.map
