import{w as K,a as D,D as O}from"./chunk-OIYGIGL5-BYynBxW5.js";import{j as e}from"./jsx-runtime-cpqHEc2t.js";import{r as w}from"./index-b8gibUUP.js";import{$ as h}from"./Button-Pc6dXscm.js";import{$ as L,ae as _,c as H,d as V,z,bV as P,A as M,_ as W}from"./trial.start-yrr1pYcE.js";import{$ as N}from"./Heading-CJLhoRaQ.js";import{$ as q,a as B,b as G,c as Y,d as J}from"./organization._organizationId.project._projectId.workspace._workspaceId.debug.request._requestId.update-CJN0pku1.js";import{a as Q,s as X}from"./index-CiWR7xsz.js";import{k as Z,b as I,ay as ee,az as $,C as te,w as A,aK as se,aN as E,aO as C}from"./index-BnTlsbFl.js";import{u as re}from"./organization._organizationId.project._projectId.workspace._workspaceId.test.test-suite._testSuiteId.run-all-tests-D5hS-hnq.js";import{u as oe}from"./organization._organizationId.project._projectId.workspace._workspaceId.test.test-suite._testSuiteId.test._testId.delete-DixT2NGP.js";import{u as ne}from"./organization._organizationId.project._projectId.workspace._workspaceId.test.test-suite._testSuiteId.test._testId.run-RgdWFNQ9.js";import{u as U}from"./organization._organizationId.project._projectId.workspace._workspaceId.test.test-suite._testSuiteId.test._testId.update-Dsp_BXSu.js";import{u as ae}from"./organization._organizationId.project._projectId.workspace._workspaceId.test.test-suite._testSuiteId.test.new-C-aKWhtb.js";import{u as ie}from"./organization._organizationId.project._projectId.workspace._workspaceId.test.test-suite._testSuiteId.update-Ce8l3YD-.js";import{E as R}from"./editable-input-CP0Ibhfa.js";import{I as d}from"./icon-pbM3MSP9.js";import{i as T}from"./invariant-DVddvGrP.js";function F(){return O("routes/organization.$organizationId.project.$projectId.workspace.$workspaceId.test.test-suite.$testSuiteId")}const le=({unitTest:s})=>{const c=w.useRef(null),{projectId:n,workspaceId:i,organizationId:o}=D(),{unitTestSuite:m,requests:u}=F(),l=oe(),v=ne(),b=U(),k={globals:{insomnia:!0,expect:!0,chai:!0,debugger:!0},asi:!0,undef:!0,node:!0,esversion:11},[j,y]=w.useState(!1);return e.jsxs("div",{className:"flex-shrink-0 overflow-hidden p-[--padding-sm]",children:[e.jsxs("div",{className:"mb-4 w-full items-center gap-4 text-wrap rounded-lg border border-solid border-[rgba(var(--color-warning-rgb),1)] bg-[--color-bg] px-3 py-2 text-sm text-[rgba(var(--color-warning-rgb),1)] shadow-lg outline-none",children:["Some time in 2026, unit tests will be deprecated in favour of"," ",e.jsx(z,{className:"cursor-pointer text-[--color-surprise]",href:"https://developer.konghq.com/insomnia/scripts/",children:"pre-request and after-response scripts."})," ","Exact timelines and how to migrate will be communicated well in advance. For now, we advise switching to scripts where possible."]}),e.jsxs("div",{className:"flex w-full items-center gap-2",title:s.name,children:[e.jsx(h,{className:"flex aspect-square h-8 flex-shrink-0 flex-nowrap items-center justify-center rounded-sm text-sm text-[--color-font] ring-1 ring-transparent transition-all hover:bg-[--hl-xs] focus:ring-inset focus:ring-[--hl-md] aria-pressed:bg-[--hl-sm]",onPress:()=>y(!j),children:e.jsx(d,{icon:j?"chevron-down":"chevron-right"})}),e.jsx(N,{className:"flex-1 truncate",children:e.jsx(R,{className:"w-full px-1",onSubmit:t=>{t&&b.submit({organizationId:o,projectId:n,workspaceId:i,testSuiteId:m._id,testId:s._id,data:{name:t}})},value:s.name})}),e.jsxs(B,{className:"flex-shrink-0","aria-label":"Request for test",onSelectionChange:t=>{T(t,"Expected request id"),b.submit({organizationId:o,projectId:n,workspaceId:i,testSuiteId:m._id,testId:s._id,data:{requestId:t.toString()}})},selectedKey:s.requestId,children:[e.jsxs(h,{"aria-label":"Select a request",className:"flex h-8 flex-1 items-center justify-center gap-2 rounded-sm px-4 py-1 text-sm text-[--color-font] ring-1 ring-transparent transition-all hover:bg-[--hl-xs] focus:ring-inset focus:ring-[--hl-md] aria-pressed:bg-[--hl-sm]",children:[e.jsx(G,{className:"flex items-center justify-center gap-2 truncate",children:({isPlaceholder:t,selectedItem:a})=>t||!a?e.jsx("span",{children:"Select a request"}):e.jsxs(w.Fragment,{children:[$(a)&&e.jsx("span",{className:`flex w-10 flex-shrink-0 items-center justify-center rounded-sm border border-solid border-[--hl-sm] text-[0.65rem] ${{GET:"bg-[rgba(var(--color-surprise-rgb),0.5)] text-[--color-font-surprise]",POST:"bg-[rgba(var(--color-success-rgb),0.5)] text-[--color-font-success]",HEAD:"bg-[rgba(var(--color-info-rgb),0.5)] text-[--color-font-info]",OPTIONS:"bg-[rgba(var(--color-info-rgb),0.5)] text-[--color-font-info]",DELETE:"bg-[rgba(var(--color-danger-rgb),0.5)] text-[--color-font-danger]",PUT:"bg-[rgba(var(--color-warning-rgb),0.5)] text-[--color-font-warning]",PATCH:"bg-[rgba(var(--color-notice-rgb),0.5)] text-[--color-font-notice]"}[a.method]||"bg-[--hl-md] text-[--color-font]"}`,children:P(a)}),E(a)&&e.jsx("span",{className:"flex w-10 flex-shrink-0 items-center justify-center rounded-sm border border-solid border-[--hl-sm] bg-[rgba(var(--color-notice-rgb),0.5)] text-[0.65rem] text-[--color-font-notice]",children:"WS"}),C(a)&&e.jsx("span",{className:"flex w-10 flex-shrink-0 items-center justify-center rounded-sm border border-solid border-[--hl-sm] bg-[rgba(var(--color-info-rgb),0.5)] text-[0.65rem] text-[--color-font-info]",children:"gRPC"}),e.jsx("span",{children:a.name||a.url||"Untitled request"})]})}),e.jsx(d,{icon:"caret-down"})]}),e.jsx(Q,{className:"flex min-w-max flex-col overflow-y-hidden",children:e.jsx(Y,{items:u.map(t=>({...t,id:t._id,key:t._id})),className:"min-w-max select-none overflow-y-auto rounded-md border border-solid border-[--hl-sm] bg-[--color-bg] py-2 text-sm shadow-lg focus:outline-none",children:t=>e.jsx(J,{className:"flex h-[--line-height-xs] w-full items-center gap-2 whitespace-nowrap bg-transparent px-[--padding-md] text-[--color-font] transition-colors hover:bg-[--hl-sm] focus:bg-[--hl-xs] focus:outline-none disabled:cursor-not-allowed aria-selected:font-bold","aria-label":t.name,textValue:t.name,value:t,children:({isSelected:a})=>e.jsxs(w.Fragment,{children:[$(t)&&e.jsx("span",{className:`flex w-10 flex-shrink-0 items-center justify-center rounded-sm border border-solid border-[--hl-sm] text-[0.65rem] ${{GET:"bg-[rgba(var(--color-surprise-rgb),0.5)] text-[--color-font-surprise]",POST:"bg-[rgba(var(--color-success-rgb),0.5)] text-[--color-font-success]",HEAD:"bg-[rgba(var(--color-info-rgb),0.5)] text-[--color-font-info]",OPTIONS:"bg-[rgba(var(--color-info-rgb),0.5)] text-[--color-font-info]",DELETE:"bg-[rgba(var(--color-danger-rgb),0.5)] text-[--color-font-danger]",PUT:"bg-[rgba(var(--color-warning-rgb),0.5)] text-[--color-font-warning]",PATCH:"bg-[rgba(var(--color-notice-rgb),0.5)] text-[--color-font-notice]"}[t.method]||"bg-[--hl-md] text-[--color-font]"}`,children:P(t)}),E(t)&&e.jsx("span",{className:"flex w-10 flex-shrink-0 items-center justify-center rounded-sm border border-solid border-[--hl-sm] bg-[rgba(var(--color-notice-rgb),0.5)] text-[0.65rem] text-[--color-font-notice]",children:"WS"}),C(t)&&e.jsx("span",{className:"flex w-10 flex-shrink-0 items-center justify-center rounded-sm border border-solid border-[--hl-sm] bg-[rgba(var(--color-info-rgb),0.5)] text-[0.65rem] text-[--color-font-info]",children:"gRPC"}),e.jsx("span",{children:t.name||t.url||"Untitled request"}),a&&e.jsx(d,{icon:"check",className:"justify-self-end text-[--color-success]"})]})})})})]}),e.jsx(h,{className:"flex aspect-square h-8 flex-shrink-0 items-center justify-center rounded-sm text-sm text-[--color-font] ring-1 ring-transparent transition-all hover:bg-[--hl-xs] focus:ring-inset focus:ring-[--hl-md] aria-pressed:bg-[--hl-sm]",onPress:()=>{X(M,{title:"Delete Test",message:`Do you really want to delete "${s.name}"?`,yesText:"Delete",noText:"Cancel",color:"danger",onDone:async t=>{t&&l.submit({organizationId:o,projectId:n,workspaceId:i,testSuiteId:m._id,testId:s._id})}})},children:e.jsx(d,{icon:"trash"})}),e.jsx(h,{className:"flex aspect-square h-8 flex-shrink-0 items-center justify-center rounded-sm text-sm text-[--color-font] ring-1 ring-transparent transition-all hover:bg-[--hl-xs] focus:ring-inset focus:ring-[--hl-md] aria-pressed:bg-[--hl-sm]",onPress:()=>{v.submit({organizationId:o,projectId:n,workspaceId:i,testSuiteId:m._id,testId:s._id})},children:e.jsx(d,{icon:"play"})})]}),j&&e.jsx(W,{id:"unit-test-editor",ref:c,dynamicHeight:!0,showPrettifyButton:!0,defaultValue:s?s.code:"",getAutocompleteSnippets:()=>{const f=(c.current?.getValue()||"").split("const ").filter(r=>r).map(r=>r.split(" ")[0]).map(r=>parseInt(r.match(/(\d+)/)?.[0]||""))?.filter(r=>!isNaN(r)),p="response"+(Math.max(...f)+1);return[{name:"Send: Current request",displayValue:"",value:`const ${p} = await insomnia.send();
expect(${p}.status).to.equal(200);`},...u.map(({name:r,_id:g})=>({name:`Send: ${r}`,displayValue:"",value:`const ${p} = await insomnia.send('${g}');
expect(${p}.status).to.equal(200);`}))]},lintOptions:k,onChange:t=>b.submit({organizationId:o,projectId:n,workspaceId:i,testSuiteId:m._id,testId:s._id,data:{code:t}}),mode:"javascript",placeholder:""})]})};async function ke({params:s}){const{workspaceId:c,testSuiteId:n}=s,i=await Z.getById(c);T(i,"Workspace not found");const m=(await I.getWithDescendants(i,[ee.type])).filter($),u=await I.findOne(te.type,{_id:n}),l=await A.getByParentId(c);return l&&l?.activeUnitTestSuiteId!==n&&await A.update(l,{activeUnitTestSuiteId:n}),T(u,"Test Suite not found"),{unitTests:await I.find(se.type,{parentId:n},{metaSortKey:1}),unitTestSuite:u,requests:m}}const ce=()=>{const{organizationId:s,projectId:c,workspaceId:n}=D(),{unitTestSuite:i,unitTests:o}=F(),m=ae(),u=re(),l=ie(),v=U(),b=u.state==="submitting",j=l.json&&typeof l.json=="object"&&"name"in l.json&&l.json?.name?.toString()||i.name,y=L({getItems:t=>[...t].map(a=>({"text/plain":a.toString()})),onReorder(t){const a=[...t.keys][0],f=o.find(r=>r._id===a),x=o.find(r=>r._id===t.target.key);if(!f||!x)return;const p=t.target.dropPosition;if(p==="before"){const r=o.findIndex(S=>S._id===x._id),g=o[r-1];g?f.metaSortKey=(g.metaSortKey+x.metaSortKey)/2:f.metaSortKey=x.metaSortKey-1}if(p==="after"){const r=o.findIndex(S=>S._id===x._id),g=o[r+1];g?f.metaSortKey=(g.metaSortKey+x.metaSortKey)/2:f.metaSortKey=x.metaSortKey+1}v.submit({organizationId:s,projectId:c,workspaceId:n,testSuiteId:i._id,testId:f._id,data:{metaSortKey:f.metaSortKey}})},renderDropIndicator(t){return e.jsx(q,{target:t,className:"!border-none outline outline-1 outline-[--color-surprise]"})}});return e.jsxs("div",{className:"flex h-full w-full flex-col divide-y divide-solid divide-[--hl-md] overflow-hidden",title:j,children:[e.jsxs("div",{className:"flex h-[--line-height-sm] flex-shrink-0 items-center gap-2 px-[--padding-md]",children:[e.jsx(N,{className:"flex w-full flex-1 flex-shrink-0 items-center gap-2 truncate text-lg",children:e.jsx(R,{className:"w-full px-1",onSubmit:t=>t&&l.submit({organizationId:s,projectId:c,workspaceId:n,testSuiteId:i._id,data:{name:t}}),value:j})}),e.jsxs(h,{"aria-label":"New test",className:"flex items-center justify-center gap-2 rounded-sm px-4 py-1 text-sm text-[--color-font] ring-1 ring-transparent transition-all hover:bg-[--hl-xs] focus:ring-inset focus:ring-[--hl-md] aria-pressed:bg-[--hl-sm]",onPress:()=>m.submit({organizationId:s,projectId:c,workspaceId:n,testSuiteId:i._id,name:"Returns 200"}),children:[e.jsx(d,{icon:"plus"}),e.jsx("span",{children:"New test"})]}),e.jsxs(h,{"aria-label":"Run all tests",className:`flex items-center justify-center gap-2 rounded-sm px-4 py-1 text-sm text-[--color-font] ring-1 ring-transparent transition-all hover:bg-[--hl-xs] focus:ring-inset focus:ring-[--hl-md] aria-pressed:bg-[--hl-sm] ${b?"animate-pulse":""}`,onPress:()=>{u.submit({organizationId:s,projectId:c,workspaceId:n,testSuiteId:i._id})},children:["Run tests",e.jsx("i",{className:"fa fa-play space-left"})]})]}),o.length===0&&e.jsxs("div",{className:"flex h-full w-full flex-1 flex-col items-center gap-2 divide-y divide-solid divide-[--hl-md] overflow-hidden overflow-y-auto p-[--padding-md] text-[--hl-lg]",children:[e.jsxs(N,{className:"flex flex-1 flex-col items-center gap-2 p-[--padding-sm] text-lg font-bold",children:[e.jsx(d,{icon:"vial",className:"w-28 flex-1"}),e.jsx("span",{children:"Add unit tests to verify your API"})]}),e.jsxs("div",{className:"flex w-full flex-1 flex-col items-center justify-evenly gap-2 p-[--padding-sm]",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(d,{icon:"lightbulb"}),e.jsx("span",{className:"truncate",children:"You can run these tests in CI with Inso CLI"})]}),e.jsxs("ul",{className:"flex flex-col gap-2",children:[e.jsx("li",{children:e.jsxs("a",{className:"flex items-center gap-2 text-sm font-bold transition-colors hover:text-[--hl] focus:text-[--hl]",href:_.unitTesting.url,children:[e.jsx("span",{className:"truncate",children:"Unit testing in Insomnia"}),e.jsx(d,{icon:"external-link"})]})}),e.jsx("li",{children:e.jsxs("a",{className:"flex items-center gap-2 text-sm font-bold transition-colors hover:text-[--hl] focus:text-[--hl]",href:_.introductionToInsoCLI.url,children:[e.jsx("span",{className:"truncate",children:"Introduction to Inso CLI"}),e.jsx(d,{icon:"external-link"})]})})]})]})]}),o.length>0&&e.jsx(H,{"aria-label":"Unit tests",dragAndDropHooks:y.dragAndDropHooks,items:o.map(t=>({...t,id:t._id,key:t._id})),className:"flex flex-1 flex-col divide-y divide-solid divide-[--hl-md] overflow-y-auto",children:t=>e.jsxs(V,{textValue:t.name,className:"outline-none",children:[e.jsx(h,{slot:"drag",className:"hidden"}),e.jsx(le,{unitTest:t,testsRunning:b})]})})]})},_e=K(ce);export{_e as T,ke as c,F as u};
//# sourceMappingURL=organization._organizationId.project._projectId.workspace._workspaceId.test.test-suite._testSuiteId-eZDqoADQ.js.map
