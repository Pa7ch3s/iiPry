import{ag as m}from"./index-BnTlsbFl.js";import{h as F}from"./chunk-WY5IRSCW-1dc6FieG.js";import{I as f,K as d,G as y}from"./import-DfaWnrdO.js";import{S as g}from"./analytics-fpOjxorv.js";import{i as l}from"./invariant-DVddvGrP.js";import{c as S}from"./router-BoVIwh1i.js";const v=async i=>{const{source:t,postmanArchiveFile:o}=i;l(typeof t=="string","Source is required."),l(["file","uri","clipboard"].includes(t),"Unsupported import type"),window.main.trackSegmentEvent({event:g.importScanned,properties:{source:t}});const n=[];if(t==="uri"){const{uri:r}=i;l(typeof r=="string"&&r.length,"URI is required"),n.push({contentStr:await f({uri:r}),oriFileName:r})}else if(t==="file"){let r;try{if(r=typeof i.filePaths=="string"?JSON.parse(i.filePaths):i.filePaths,!Array.isArray(r))throw new Error("filePaths is not an array");if(r=r.filter(e=>typeof e=="string"&&e),r.length===0)throw new Error("filePaths is empty")}catch{throw new Error("File is required")}const u=r.filter(e=>m.extname(e)===".zip"),h=r.filter(e=>m.extname(e)!==".zip");for(const e of u){let c=function({contentStr:s,oriFileName:w}){return{contentStr:s,oriFileName:`${w} in ${m.basename(e)}`}};const a=await d(e);n.push(...a.collectionList.map(c),...a.envList.map(c))}let p=null;if(o)try{const e=await window.main.insecureReadFile({path:o});p=JSON.parse(e)}catch{return[{oriFileName:o,errors:["Failed to parse archive.json file"]}]}for(const e of h){const c=`file://${e}`;let a=await f({uri:c});if(p)try{const s=JSON.parse(a);p.environment?.[s.id]&&(s._postman_variable_scope="environment",a=JSON.stringify(s))}catch{}n.push({contentStr:a,oriFileName:m.basename(e),oriFilePath:e})}}else n.push({contentStr:window.clipboard.readText(),oriFileName:"clipboard"});if(n.length===0)throw new Error("No content to import");return await y(n)};async function O({request:i}){try{const t=await i.formData(),o=Object.fromEntries(t.entries());return await v(o)}catch(t){return[{errors:[t instanceof Error?t.message:"Unknown error"]}]}}const x=S(i=>t=>i(t,{action:F("/import/scan"),method:"POST"}));export{O as c,v as s,x as u};
//# sourceMappingURL=import.scan-CIM-8ira.js.map
