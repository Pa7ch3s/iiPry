import{u as x,N as C,b as i,e as M,k as U,ay as A,aI as B,aG as H,aL as h,l as k,r as G,aF as J,a7 as T}from"./index-BnTlsbFl.js";import{i as N}from"./invariant-DVddvGrP.js";import{b as D}from"./router-BoVIwh1i.js";async function X(l){const s=new URL(l.request.url).searchParams,g=s.get("organizationId");N(g,"organizationId is required");const p=s.get("projectId");N(p,"projectId is required");const I=s.get("workspaceId"),o=s.get("filter"),z=e=>o?!!T(o||"",[e.name,e.url,e.description].join(" "),{splitSpace:!1,loose:!0})?.indexes:!0,{accountId:S}=await x.getOrCreate(),u=JSON.parse(localStorage.getItem(`${S}:organizations`)||"[]"),b=C(g)?[g]:u.map(e=>e.id),d=await i.find(M.type,{parentId:{$in:b}}),P=d.map(e=>e._id),c=await i.find(U.type,{parentId:{$in:P}}),f=c.map(e=>e._id),t=new Map;d.forEach(e=>{t.set(e._id,{type:"Project",organizationId:e.parentId,projectId:e._id})}),c.forEach(e=>{t.set(e._id,{type:"Workspace",organizationId:t.get(e.parentId).organizationId,projectId:e.parentId,workspaceId:e._id})});const _=async({$in:e})=>{const a=await i.find(J.type,{parentId:{$in:e}});for(const r of a)t.set(r._id,{type:"RequestGroup",organizationId:t.get(r.parentId).organizationId,projectId:t.get(r.parentId).projectId,workspaceId:t.get(r.parentId).workspaceId});const n=a.map(r=>r._id),R=n.length>0?await _({$in:n}):[];for(const r of R)t.set(r._id,{type:"RequestGroup",organizationId:t.get(r.parentId).organizationId,projectId:t.get(r.parentId).projectId,workspaceId:t.get(r.parentId).workspaceId});return[...a,...R]},m=await _({$in:f}),q=await i.find(A.type,{parentId:{$in:[...f,...m.map(e=>e._id)]}});for(const e of q)t.set(e._id,{type:"Request",organizationId:t.get(e.parentId).organizationId,projectId:t.get(e.parentId).projectId,workspaceId:t.get(e.parentId).workspaceId});const y=await i.find(B.type,{parentId:{$in:[...f,...m.map(e=>e._id)]}});for(const e of y)t.set(e._id,{type:"GrpcRequest",organizationId:t.get(e.parentId).organizationId,projectId:t.get(e.parentId).projectId,workspaceId:t.get(e.parentId).workspaceId});const $=await i.find(H.type,{parentId:{$in:[...f,...m.map(e=>e._id)]}});for(const e of $)t.set(e._id,{type:"WebSocketRequest",organizationId:t.get(e.parentId).organizationId,projectId:t.get(e.parentId).projectId,workspaceId:t.get(e.parentId).workspaceId});const w=[...q,...y,...$],[j]=await i.find(h.type,{parentId:I}),v=await i.find(h.type,{parentId:j?._id}),F=j?[j,...v]:[],L=w.filter(e=>t.get(e.parentId).workspaceId===I),O=w.filter(e=>t.get(e.parentId).workspaceId!==I),E=c.filter(e=>e.parentId===p),W=c.filter(e=>e.parentId!==p);return{current:{requests:L.filter(z).slice(0,100).map(e=>({id:e._id,url:`/organization/${t.get(e.parentId)?.organizationId}/project/${t.get(e.parentId).projectId}/workspace/${t.get(e.parentId)?.workspaceId}/debug/request/${e._id}`,name:e.name,item:e,organizationName:u.find(a=>a.id===t.get(e.parentId)?.organizationId)?.display_name||"",projectName:d.find(a=>a._id===t.get(e.parentId)?.projectId)?.name||"",workspaceName:c.find(a=>a._id===t.get(e.parentId)?.workspaceId)?.name||""})),files:E.map(e=>{const a=d.find(n=>n._id===e.parentId);return{id:e._id,url:`/organization/${t.get(e.parentId)?.organizationId}/project/${t.get(e.parentId)?.projectId}/workspace/${e._id}/${k(e.scope)}`,name:e.name,item:{...e,teamProjectId:a&&G(a)?a.remoteId:""},organizationName:u.find(n=>n.id===t.get(e.parentId)?.organizationId)?.display_name||"",projectName:d.find(n=>n._id===t.get(e.parentId)?.projectId)?.name||""}}),environments:F},other:{requests:O.filter(z).slice(0,100).map(e=>({id:e._id,url:`/organization/${t.get(e.parentId)?.organizationId}/project/${t.get(e.parentId)?.projectId}/workspace/${t.get(e.parentId).workspaceId}/debug/request/${e._id}`,name:e.name,item:e,organizationName:u.find(a=>a.id===t.get(e.parentId)?.organizationId)?.display_name||"",projectName:d.find(a=>a._id===t.get(e.parentId)?.projectId)?.name||"",workspaceName:c.find(a=>a._id===t.get(e.parentId)?.workspaceId)?.name||""})),files:W.map(e=>{const a=d.find(n=>n._id===e.parentId);return{id:e._id,url:`/organization/${t.get(e.parentId)?.organizationId}/project/${t.get(e.parentId)?.projectId}/workspace/${e._id}/${k(e.scope)}`,name:e.name,item:{...e,teamProjectId:a&&G(a)?a.remoteId:""},organizationName:u.find(n=>n.id===t.get(e.parentId)?.organizationId)?.display_name||"",projectName:d.find(n=>n._id===t.get(e.parentId)?.projectId)?.name||""}})}}}const Y=D(l=>({organizationId:s,projectId:g,workspaceId:p,filter:I})=>{const o=new URLSearchParams;return o.set("organizationId",s),o.set("projectId",g),p&&o.set("workspaceId",p),I&&o.set("filter",I),l(`/commands?${o.toString()}`,{flushSync:!0})});export{X as c,Y as u};
//# sourceMappingURL=commands-CpETkOnR.js.map
