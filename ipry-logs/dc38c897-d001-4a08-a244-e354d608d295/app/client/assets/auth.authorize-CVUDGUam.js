import{h as c}from"./chunk-WY5IRSCW-1dc6FieG.js";import{w as h,r as x,c as y,e as b}from"./chunk-OIYGIGL5-BYynBxW5.js";import{j as e}from"./jsx-runtime-cpqHEc2t.js";import{r as w}from"./index-b8gibUUP.js";import{$ as v}from"./Button-Pc6dXscm.js";import{$ as j}from"./Heading-CJLhoRaQ.js";import{u as i,d8 as S}from"./index-BnTlsbFl.js";import{S as N}from"./analytics-fpOjxorv.js";import{s as I,g as F}from"./auth-session-provider.client-B6EymBM1.js";import{I as f}from"./icon-pbM3MSP9.js";import{i as k}from"./insomnia-fetch-B_XbrnGh.js";import{v as E}from"./vault-key.client-BYwC5SBL.js";import{i as g}from"./invariant-DVddvGrP.js";import{c as A}from"./router-BoVIwh1i.js";async function _({request:r}){const s=await r.json();g(typeof s?.code=="string","Expected code to be a string");const o=await I(s.code);if(o){const t=o instanceof Error?o.message:"An unknown error occurred";return{errors:{message:t==="Failed to fetch"?"Network failed, please try again. If the problem persists, check your network and proxy settings.":t}}}console.log("Login successful"),window.main.trackSegmentEvent({event:N.loginSuccess}),window.localStorage.setItem("hasUserLoggedInBefore","true");const n=await i.getOrCreate(),{accountId:l,id:d}=n;try{const{salt:t}=await k({method:"GET",path:"/v1/user/vault",sessionId:d});if(t){await i.update(n,{vaultSalt:t});const a=await S(l);if(a&&await E(n,a,t)){const p=await window.main.secretStorage.encryptString(a);await i.update(n,{vaultKey:p,vaultSalt:t})}}}catch(t){console.error(t)}return x("/organization")}const $=A(r=>s=>{r(s,{action:c("/auth/authorize"),method:"POST",encType:"application/json"})}),R=()=>{const r=F(),s=()=>{window.clipboard.writeText(r)},o=$(),n=y(),t=b().filter(a=>a.formAction===c("/auth/authorize")).some(a=>a.state!=="idle");return e.jsxs("div",{className:"flex flex-col gap-[--padding-md] text-[--color-font]",children:[e.jsx(j,{className:"px-3 text-center text-2xl font-bold",children:"Authorizing Insomnia"}),e.jsxs(w.Fragment,{children:[e.jsx("p",{children:"A new page should have opened in your default web browser. Please log in. If you choose to login with SSO and it uses a different email to your previous login your teams will not be migrated."}),e.jsxs("div",{className:"flex flex-col gap-3 rounded-md bg-[--hl-sm] p-[--padding-md]",children:[e.jsx("p",{className:"text-[rgba(var(--color-font-rgb),0.8))] text-start",children:"If you were not redirected back here after creating an account, please copy and paste the following URL into your browser to complete login."}),e.jsxs("div",{className:"form-control form-control--outlined no-pad-top flex",children:[e.jsx("input",{type:"text",value:r,style:{marginRight:"var(--padding-sm)"},readOnly:!0}),e.jsxs("button",{className:"btn btn--super-compact btn--outlined",onClick:s,style:{display:"flex",alignItems:"center",gap:"var(--padding-xs)"},children:[e.jsx("i",{className:"fa fa-clipboard","aria-hidden":"true"}),"Copy"]})]}),e.jsx("p",{className:"text-[rgba(var(--color-font-rgb),0.8))] text-start",children:"If your browser does not open the Insomnia app automatically you can manually add the generated token here."}),e.jsxs("form",{onSubmit:a=>{a.preventDefault();const m=a.currentTarget,u=new FormData(m).get("code");g(typeof u=="string","Expected code to be a string"),o.submit({code:u})},children:[e.jsxs("div",{className:"form-control form-control--outlined no-pad-top",style:{display:"flex"},children:[e.jsx("input",{type:"text",name:"code",style:{marginRight:"var(--padding-sm)"}}),e.jsxs("button",{className:"btn btn--super-compact btn--outlined",type:"submit",style:{display:"flex",alignItems:"center",gap:"var(--padding-xs)"},disabled:t,children:[e.jsx(f,{icon:t?"spinner":"sign-in",className:t?"animate-spin":""}),"Log in"]})]}),o.data?.errors?.message&&e.jsx("p",{children:o.data.errors.message})]})]})]}),e.jsx("div",{className:"flex w-full justify-center",children:e.jsxs(v,{className:"flex items-center gap-2",onPress:()=>{n(c("/auth/login"))},children:[e.jsx(f,{icon:"arrow-left"}),e.jsx("span",{children:"Go Back"})]})})]})},q=h(R);export{q as a,_ as c,$ as u};
//# sourceMappingURL=auth.authorize-CVUDGUam.js.map
