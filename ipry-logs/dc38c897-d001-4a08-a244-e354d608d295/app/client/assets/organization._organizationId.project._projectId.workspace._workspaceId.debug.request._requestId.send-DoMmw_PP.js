import{cc as y,a8 as V,aL as D,bd as h,ae as F,c_ as G,ag as U,c$ as z}from"./index-BnTlsbFl.js";import{g as B}from"./_commonjsHelpers-CE1G-McA.js";import{r as H}from"./index-BMm92w-c.js";import{m as M}from"./index-BKSSlv8C.js";import{h as Z}from"./chunk-WY5IRSCW-1dc6FieG.js";import{r as j}from"./chunk-OIYGIGL5-BYynBxW5.js";import{aq as k,f as W,ar as Q,t as J,g as K,h as Y,i as ee,as as te}from"./index-wZAP8gf2.js";import{i as re}from"./invariant-DVddvGrP.js";import{c as ne}from"./router-BoVIwh1i.js";var O={exports:{}};/*!
 * content-disposition
 * Copyright(c) 2014-2017 Douglas Christopher Wilson
 * MIT Licensed
 */var X;function ae(){if(X)return O.exports;X=1,O.exports=i,O.exports.parse=g;var p=require("path").basename,t=H().Buffer,l=/[\x00-\x20"'()*,/:;<=>?@[\\\]{}\x7f]/g,v=/%[0-9A-Fa-f]{2}/,E=/%([0-9A-Fa-f]{2})/g,d=/[^\x20-\x7e\xa0-\xff]/g,c=/\\([\u0000-\u007f])/g,m=/([\\"])/g,q=/;[\x09\x20]*([!#$%&'*+.0-9A-Z^_`a-z|~-]+)[\x09\x20]*=[\x09\x20]*("(?:[\x20!\x23-\x5b\x5d-\x7e\x80-\xff]|\\[\x20-\x7e])*"|[!#$%&'*+.0-9A-Z^_`a-z|~-]+)[\x09\x20]*/g,S=/^[\x20-\x7e\x80-\xff]+$/,a=/^[!#$%&'*+.0-9A-Z^_`a-z|~-]+$/,I=/^([A-Za-z0-9!#$%&+\-^_`{}~]+)'(?:[A-Za-z]{2,3}(?:-[A-Za-z]{3}){0,3}|[A-Za-z]{4,8}|)'((?:%[0-9A-Fa-f]{2}|[A-Za-z0-9!#$&+.^_`|~-])+)$/,_=/^([!#$%&'*+.0-9A-Z^_`a-z|~-]+)[\x09\x20]*(?:$|;)/;function i(r,e){var o=e||{},n=o.type||"attachment",s=A(r,o.fallback);return b(new T(n,s))}function A(r,e){if(r!==void 0){var o={};if(typeof r!="string")throw new TypeError("filename must be a string");if(e===void 0&&(e=!0),typeof e!="string"&&typeof e!="boolean")throw new TypeError("fallback must be a string or boolean");if(typeof e=="string"&&d.test(e))throw new TypeError("fallback must be ISO-8859-1 string");var n=p(r),s=S.test(n),u=typeof e!="string"?e&&R(n):p(e),f=typeof u=="string"&&u!==n;return(f||!s||v.test(n))&&(o["filename*"]=n),(s||f)&&(o.filename=f?u:n),o}}function b(r){var e=r.parameters,o=r.type;if(!o||typeof o!="string"||!a.test(o))throw new TypeError("invalid type");var n=String(o).toLowerCase();if(e&&typeof e=="object")for(var s,u=Object.keys(e).sort(),f=0;f<u.length;f++){s=u[f];var x=s.substr(-1)==="*"?C(e[s]):w(e[s]);n+="; "+s+"="+x}return n}function P(r){var e=I.exec(r);if(!e)throw new TypeError("invalid extended field value");var o=e[1].toLowerCase(),n=e[2],s,u=n.replace(E,N);switch(o){case"iso-8859-1":s=R(u);break;case"utf-8":s=t.from(u,"binary").toString("utf8");break;default:throw new TypeError("unsupported charset in extended field")}return s}function R(r){return String(r).replace(d,"?")}function g(r){if(!r||typeof r!="string")throw new TypeError("argument string is required");var e=_.exec(r);if(!e)throw new TypeError("invalid type format");var o=e[0].length,n=e[1].toLowerCase(),s,u=[],f={},x;for(o=q.lastIndex=e[0].substr(-1)===";"?o-1:o;e=q.exec(r);){if(e.index!==o)throw new TypeError("invalid parameter format");if(o+=e[0].length,s=e[1].toLowerCase(),x=e[2],u.indexOf(s)!==-1)throw new TypeError("invalid duplicate parameter");if(u.push(s),s.indexOf("*")+1===s.length){s=s.slice(0,-1),x=P(x),f[s]=x;continue}typeof f[s]!="string"&&(x[0]==='"'&&(x=x.substr(1,x.length-2).replace(c,"$1")),f[s]=x)}if(o!==-1&&o!==r.length)throw new TypeError("invalid parameter format");return new T(n,f)}function N(r,e){return String.fromCharCode(parseInt(e,16))}function $(r){return"%"+String(r).charCodeAt(0).toString(16).toUpperCase()}function w(r){var e=String(r);return'"'+e.replace(m,"\\$1")+'"'}function C(r){var e=String(r),o=encodeURIComponent(e).replace(l,$);return"UTF-8''"+o}function T(r,e){this.type=r,this.parameters=e}return O.exports}var se=ae();const oe=B(se),L=(p,t,l,v)=>{re(p,"filename should be set by now");const E=z(p),d=h.getBodyStream(t);return!d||typeof d=="string"?null:(d.pipe(E),new Promise(c=>{d.on("end",async()=>{t.error=`Saved to ${p}`;const m=await h.create(t,v);await y.update(l,{activeResponseId:m._id}),c(null)}),d.on("error",async m=>{console.warn("Failed to download request after sending",t.bodyPath,m);const q=await h.create(t,v);await y.update(l,{activeResponseId:q._id}),c(null)})}))},ie=async p=>{const{requestId:t,userUploadEnvironment:l,shouldPromptForPathAfterResponse:v,ignoreUndefinedEnvVariable:E,testResultCollector:d,iteration:c,iterationCount:m,transientVariables:q,runtime:S=k}=p;window.main.startExecution({requestId:t});const a=await W(t),I=await y.getOrCreateByParentId(t),_=q||{...D.init(),_id:V(),type:D.type,parentId:a.environment.parentId,modified:0,created:Date.now(),name:"Transient Environment",data:{}};window.main.addExecutionStep({requestId:t,stepName:"Executing pre-request script"});const i=await Q(a,_,l,c,m,S);if("error"in i){const n=await h.create({_id:a.responseId,parentId:t,environmentId:a.environment._id,statusMessage:"Error",error:i.error,timelinePath:a.timelinePath},a.settings.maxHistoryResponses);return await y.updateOrCreateByParentId(t,{activeResponseId:n._id}),window.main.completeExecutionStep({requestId:t}),{nextRequestIdOrName:i.execution?.nextRequestIdOrName}}if(i.execution?.skipRequest){const n=await h.create({_id:a.responseId,parentId:t,environmentId:a.environment._id,statusMessage:"Cancelled",error:"Request was cancelled by pre-request script",timelinePath:a.timelinePath},a.settings.maxHistoryResponses);return await y.updateOrCreateByParentId(t,{activeResponseId:n._id}),window.main.completeExecutionStep({requestId:t}),{nextRequestIdOrName:i.execution?.nextRequestIdOrName}}window.main.completeExecutionStep({requestId:t});const A=i.request.afterResponseScript?`${i.request.afterResponseScript}`:void 0;i.request.afterResponseScript="",window.main.addExecutionStep({requestId:t,stepName:"Rendering request"});const b=await J({request:i.request,environment:i.environment,purpose:"send",extraInfo:void 0,baseEnvironment:i.baseEnvironment,userUploadEnvironment:i.userUploadEnvironment,transientVariables:i.transientVariables,ignoreUndefinedEnvVariable:E}),P=await K(b);window.main.completeExecutionStep({requestId:t}),F(P),window.main.addExecutionStep({requestId:t,stepName:"Sending request"});const R=await Y(P,i.clientCertificates,a.caCert,i.settings,a.timelinePath,a.responseId,S);if(window.main.completeExecutionStep({requestId:t}),"error"in R){const n=await h.create({_id:a.responseId,parentId:t,environmentId:a.environment._id,statusMessage:"Error",error:R.error,timelinePath:a.timelinePath},a.settings.maxHistoryResponses);return await y.updateOrCreateByParentId(t,{activeResponseId:n._id}),window.main.completeExecutionStep({requestId:t}),{nextRequestIdOrName:i.execution?.nextRequestIdOrName}}const g=await ee(R,a.activeEnvironmentId,P,b.context),N=g.statusCode&&g.statusCode>=200&&g.statusCode<300&&g.bodyPath,$=v&&N;i.request.afterResponseScript=A,window.main.addExecutionStep({requestId:t,stepName:"Executing after-response script"});const w=await te({...a,...i,transientVariables:i.transientVariables||_,response:R,iteration:c,iterationCount:m,runtime:S});if("error"in w){const n=await h.create({_id:a.responseId,parentId:t,environmentId:a.environment._id,statusMessage:"Error",error:w.error,timelinePath:a.timelinePath},a.settings.maxHistoryResponses);return await y.updateOrCreateByParentId(t,{activeResponseId:n._id}),window.main.completeExecutionStep({requestId:t}),{nextRequestIdOrName:w.execution?.nextRequestIdOrName}}window.main.completeExecutionStep({requestId:t});const C=(i.requestTestResults||[]).map(n=>({...n,category:"pre-request"})),T=(w?.requestTestResults||[]).map(n=>({...n,category:"after-response"}))||[];if(d){d.results=[...d.results,...C,...T];const n=await window.main.getExecution({requestId:t});d.duration=n.reduce((s,u)=>s+(u.duration||0),0),d.responseId=R._id}const r=w?{...g,requestTestResults:[...C,...T]}:g;if(!$){const n=await h.create(r,a.settings.maxHistoryResponses);return await y.update(I,{activeResponseId:n._id}),{nextRequestIdOrName:w.execution?.nextRequestIdOrName}}if(I.downloadPath){const n=G(r.headers||[]),s=n?oe.parse(n.value).parameters.filename:`${a.request.name.replace(/\s/g,"-").toLowerCase()}.${r.contentType&&M.extension(r.contentType)||"unknown"}`;return L(U.join(I.downloadPath,s),r,I,a.settings.maxHistoryResponses),{nextRequestIdOrName:w.execution?.nextRequestIdOrName}}const e=window.localStorage.getItem("insomnia.sendAndDownloadLocation"),{filePath:o}=await window.dialog.showSaveDialog({title:"Select Download Location",buttonLabel:"Save",...e?{defaultPath:e}:{}});return o?(window.localStorage.setItem("insomnia.sendAndDownloadLocation",o),L(o,r,I,a.settings.maxHistoryResponses),{nextRequestIdOrName:w.execution?.nextRequestIdOrName}):{nextRequestIdOrName:w.execution?.nextRequestIdOrName}};async function ve({request:p,params:t}){const{requestId:l}=t,{shouldPromptForPathAfterResponse:v,ignoreUndefinedEnvVariable:E}=await p.json();try{return await ie({requestId:l,shouldPromptForPathAfterResponse:v,ignoreUndefinedEnvVariable:E}),null}catch(d){console.error("[request] Failed to send request",d);const c=new URL(p.url),m=d.error||d;return c.searchParams.set("error",m),m?.extraInfo&&m?.extraInfo?.subType==="environmentVariable"&&(c.searchParams.set("envVariableMissing","1"),c.searchParams.set("undefinedEnvironmentVariables",m?.extraInfo?.undefinedEnvironmentVariables)),window.main.completeExecutionStep({requestId:l}),j(`${c.pathname}?${c.searchParams}`)}}const Ee=ne(p=>({organizationId:t,projectId:l,workspaceId:v,requestId:E,params:d})=>p(JSON.stringify(d),{method:"POST",action:Z("/organization/:organizationId/project/:projectId/workspace/:workspaceId/debug/request/:requestId/send",{organizationId:t,projectId:l,workspaceId:v,requestId:E}),encType:"application/json"}));export{ve as c,ie as s,Ee as u};
//# sourceMappingURL=organization._organizationId.project._projectId.workspace._workspaceId.debug.request._requestId.send-DoMmw_PP.js.map
