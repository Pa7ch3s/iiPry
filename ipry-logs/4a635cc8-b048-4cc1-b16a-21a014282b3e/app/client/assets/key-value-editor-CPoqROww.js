import{j as e}from"./jsx-runtime-cpqHEc2t.js";import{_ as M,$ as K,v as k,a0 as ne,a1 as _,a2 as ae,a3 as L,t as j,n as le,a4 as ie,a5 as B,a6 as H}from"./index-BnTlsbFl.js";import{r as v}from"./index-b8gibUUP.js";import{A as W,_ as oe,a0 as V,$ as ce,a1 as q,a2 as de,a3 as me}from"./trial.start-yrr1pYcE.js";import{$ as z}from"./Button-Pc6dXscm.js";import{A as fe,$ as ue,c as he,d as xe}from"./organization._organizationId.project._projectId.workspace._workspaceId.debug.request._requestId.update-CJN0pku1.js";import{s as C,$ as pe,a as ge,b as be,c as ve}from"./index-CiWR7xsz.js";import{I as w}from"./icon-pbM3MSP9.js";import{T as F}from"./tooltip-BiEx1s0w.js";import{N as G}from"./index-wZAP8gf2.js";const ye=/^\$|\./,U=(s,n)=>s.match(ye)?`"${s}" cannot begin with '$' or contain a '.'`:s===G&&n?`"${G}" is a reserved key`:s===M&&n?`"${M}" is a reserved key`:s===K&&n?`"${K}" is a reserved key`:null;function A(s,n=!0){for(const h in s){let c=null;if(c=U(h,n),c||(typeof s[h]=="object"&&(c=A(s[h],!1)),c))return c}return null}function Ve(s,n,h,c){const p=s?k.JSON:k.KVPAIR,m=s?[]:ne(n.data,n.dataPropertyOrder),l=s&&n.kvPairData?.some(f=>!f.enabled),y=s&&n.kvPairData?.some((f,x)=>n.kvPairData?.slice(x+1).some(b=>f.name.trim()===b.name.trim()&&b.enabled));!h&&p===k.KVPAIR?C(fe,{title:"Error",message:"Please modify and fix the JSON string error before switch to Table view"}):l||y?C(W,{title:"Change Environment Type",message:e.jsxs(e.Fragment,{children:[l&&e.jsx("p",{children:"All disabled items will be lost."}),y&&e.jsx("p",{children:"Items with same name will be lost except the last one."}),e.jsx("p",{children:"Are you sure to continue?"})]}),onDone:async f=>{f&&c(p,m)}}):c(p,m)}const je=v.forwardRef(({environmentInfo:s,onBlur:n,onChange:h},c)=>{const p=v.useRef(null),m=v.useRef(""),[l,y]=v.useState(""),f=v.useCallback(()=>{const u=p.current.getValue();if(!p.current||!u)return null;const g=_.parse(p.current.getValue(),ae,L);return{object:g.object,propertyOrder:g.map||null}},[]);v.useImperativeHandle(c,()=>({isValid:()=>!m.current,getValue:f}),[f]);const x=u=>{m.current=u,y(u)},b=_.stringify(s.object,s.propertyOrder||null,L);return e.jsxs("div",{className:"environment-editor",children:[e.jsx(oe,{id:"environment-editor",ref:p,autoPrettify:!0,enableNunjucks:!0,onChange:()=>{x("");try{const u=f();if(u?.object){const g=A(u.object);g?x(g):h?.(u)}}catch(u){x(u.message)}},defaultValue:b,mode:"application/json",onBlur:n}),l&&e.jsx("p",{className:"notice error margin",children:l})]})});je.displayName="EnvironmentEditor";const Ne=s=>{const{value:n,className:h,placeholder:c,enabled:p,itemId:m,onShowPassword:l,onHidePassword:y,onChange:f}=s,[x,b]=v.useState(!0),u=()=>{x&&l?l(n):!x&&y&&y(n),b(g=>!g)};return e.jsxs("div",{className:`flex h-full w-full items-center justify-between ${h}`,children:[e.jsx("div",{className:"h-full w-full flex-1",children:x?e.jsx("input",{value:n,className:"h-full w-full placeholder-[--hl-lg]",onChange:g=>f(g.target.value),placeholder:c,readOnly:!p,type:"password"}):e.jsx(V,{id:`environment-kv-editor-value-${m}`,placeholder:c,defaultValue:n,readOnly:!p,onChange:g=>f(g)})}),e.jsx("button",{className:"m-0 h-full items-center px-1",onClick:u,children:x?e.jsx("i",{className:"fa fa-eye-slash"}):e.jsx("i",{className:"fa fa-eye"})})]})},P="h-full px-2 flex items-center",D=(s=!0)=>({id:le("envPair"),name:"",value:"",type:j.STRING,enabled:s}),T=s=>{const{tabIndex:n,...h}=s,c=v.useRef(null);return v.useEffect(()=>{c.current&&typeof n=="number"&&(c.current.tabIndex=n)}),e.jsx(z,{...h,ref:c})},Ee=({data:s,onChange:n,vaultKey:h="",isPrivate:c=!1,textOnly:p=!1,disabled:m=!1})=>{const l=v.useMemo(()=>s.length>0?[...s]:[D()],[JSON.stringify(s)]),y=v.useRef(null),[f,x]=v.useState([]),b=h===""?{}:ie(h,!0),u=[{id:j.STRING,name:"Text"}];p||u.push({id:j.JSON,name:"JSON"});const g=[{id:j.SECRET,name:"Secret"}],R=c&&h?u.concat(g):u,X=(r,t)=>{const i=l.filter(d=>d.id!==r[0]),o=l.find(d=>d.id===r[0]);return o?[...i.slice(0,t),o,...i.slice(t)]:l},{dragAndDropHooks:Y}=ce({getItems:r=>[...r].map(t=>({"text/plain":t.toString()})),onReorder(r){const t=[...r.keys].map(o=>o.toString()),i=l.findIndex(o=>o.id===r.target.key.toString());n(X(t,i))},renderDragPreview(r){const t=l.find(o=>o.id===r[0]["text/plain"])||D(),i=document.querySelector(`[data-key="${t.id}"]`);return e.jsx("div",{className:"flex h-[--line-height-sm] bg-[--color-bg] outline-none",style:{width:i?.clientWidth},children:J(t)})},renderDropIndicator(r){return e.jsx(ue,{target:r,className:"!border-none outline outline-1 outline-[--color-surprise]"})}}),N=(r,t,i)=>{const o=l.findIndex(d=>d.id===r);if(o!==-1){const d=l[o];d.enabled=!0,d[t]=i,i===j.JSON&&d.value.trim()===""&&(d.value=JSON.stringify({}))}n(l)},Q=(r,t)=>{const i=l.find(o=>o.id===r);if(i){const{type:o,value:d}=i;if(o===t)return;if(o===j.SECRET){const $=R.find(S=>S.id===t)?.name;C(W,{title:`Change from Secret to ${$}`,message:"This will make the value unmasked and unencrypted. Besides, none-secret item will not be wrapped with vault namespace when using as environment variable.",yesText:"Change",noText:"Cancel",onDone:async S=>{S&&(N(r,"type",t),N(r,"value",B(d,b)))}})}else t===j.SECRET&&N(r,"value",H(d,b)),N(r,"type",t)}},Z=r=>{const t=D(),i=l.length-1;l.splice(i===-1?0:i+1,0,t),n(l)},ee=r=>{const t=l.filter(i=>i.id!==r);n(t)},te=r=>{try{return JSON.parse(r),!0}catch{return!1}},J=r=>{const{id:t,name:i,value:o,type:d,enabled:$=!1}=r,S=l.findIndex(a=>a.id===t),O=f.find(a=>a.id===t),re=i!==""&&l.slice(S+1).some(a=>a.name.trim()===i.trim()&&a.enabled),se=te(o);return e.jsxs(e.Fragment,{children:[!m&&e.jsx("div",{slot:"drag",className:`${P} flex w-6 flex-shrink-0 items-center justify-end border-l border-r-0`,style:{padding:0},children:e.jsx(w,{icon:"grip-vertical",className:"mr-1 cursor-grab"})}),e.jsxs("div",{className:`${P} relative flex h-full w-[30%] flex-grow pl-1`,children:[e.jsx(V,{id:`environment-kv-editor-name-${t}`,placeholder:"Input Name",defaultValue:i,readOnly:!$||m,onChange:a=>{const E=U(a,!0);E?x(O?f.map(I=>I.id===t?{id:t,error:E}:I):[...f,{id:t,error:E}]):(O&&x(f.filter(I=>I.id!==t)),N(t,"name",a))}}),O&&e.jsx(F,{message:O.error,delay:200,children:e.jsx("i",{className:"fa fa-exclamation-circle text-[--color-danger]"})}),re&&e.jsx(F,{message:`Duplicate name: ${i}. Only the last item with same name will be used.`,delay:200,children:e.jsx("i",{className:"fa fa-exclamation-circle text-[--color-warning]"})})]}),e.jsxs("div",{className:`${P} relative w-[50%]`,children:[d===j.STRING&&e.jsx(V,{id:`environment-kv-editor-value-${t}`,placeholder:"Input Value",defaultValue:o.toString(),readOnly:!$||m,onChange:a=>N(t,"value",a)}),d===j.JSON&&e.jsxs(T,{className:"flex w-full flex-1 items-center justify-center gap-2 overflow-hidden rounded-sm px-2 py-1 text-sm text-[--color-font] ring-1 ring-transparent transition-all hover:bg-[--hl-xs] focus:ring-inset focus:ring-[--hl-md] aria-pressed:bg-[--hl-sm]",tabIndex:-1,isDisabled:!$||m,onPress:()=>{if(y.current){const a=y.current;a.setError(""),a.show({submitName:"Done",title:`Edit ${i} value`,defaultValue:o.toString(),mode:"application/json",onChange:E=>{a.setError("");try{const I=A(JSON.parse(E));I?a.setError(I):N(t,"value",E)}catch(I){a.setError(I.message)}},hideMode:!0})}},children:[e.jsx("i",{className:"fa fa-pencil-square-o space-right","aria-label":"Edit JSON"}),"Click to Edit"]}),d===j.SECRET&&e.jsx(Ne,{itemId:t,enabled:$&&!m,placeholder:"Input Secret",value:B(o,b),onChange:a=>{const E=H(a,b);N(t,"value",E)}})]}),e.jsx("div",{className:`${P} w-32`,children:e.jsxs(pe,{children:[e.jsxs(T,{className:"flex w-full flex-1 items-center justify-between rounded-sm px-[--padding-sm] py-1 text-sm font-bold text-[--color-font] hover:bg-[--hl-xs] aria-pressed:bg-[--hl-sm]",tabIndex:-1,"aria-label":"Type Selection",isDisabled:m,children:[e.jsx("span",{className:"flex items-center justify-center gap-2 truncate",children:R.find(a=>a.id===d)?.name}),e.jsx(w,{icon:"caret-down"})]}),e.jsx(ge,{className:"border-solid border-[--hl-sm] bg-[--color-bg] shadow-lg",children:e.jsx(be,{"aria-label":"environment-kv-editor-type-selector",selectionMode:"single",selectedKeys:[d],disabledKeys:se||o.trim()===""?[]:[j.JSON],items:R,children:a=>e.jsx(ve,{id:a.id,className:"react-aria-ListBoxItem flex h-[--line-height-xs] w-full items-center gap-2 whitespace-nowrap bg-transparent pl-[--padding-sm] pr-[--padding-xl] text-sm text-[--color-font] transition-colors hover:bg-[--hl-sm] focus:bg-[--hl-xs] focus:outline-none aria-disabled:cursor-not-allowed aria-disabled:bg-transparent aria-disabled:text-[--hl-lg] aria-selected:font-bold","aria-label":a.name,onAction:()=>Q(t,a.id),children:({isSelected:E})=>e.jsxs(e.Fragment,{children:[e.jsx("span",{children:a.name}),E&&e.jsx(w,{icon:"check",className:"justify-self-end text-[--color-success]"})]})},a.id)})})]})}),e.jsxs("div",{className:`${P} w-20`,children:[e.jsx(T,{className:"flex aspect-square h-7 items-center justify-center rounded-sm text-sm text-[--color-font] ring-1 ring-transparent transition-all hover:bg-[--hl-xs] focus:ring-inset focus:ring-[--hl-md]",tabIndex:-1,"aria-label":$?"Disable Row":"Enable Row",isDisabled:m,onPress:()=>N(t,"enabled",!$),children:e.jsx(w,{icon:$?"check-square":"square"})}),e.jsx(q,{className:"flex aspect-square h-7 items-center justify-center rounded-sm text-sm text-[--color-font] ring-1 ring-transparent transition-all hover:bg-[--hl-xs] focus:ring-inset focus:ring-[--hl-md] disabled:opacity-50 aria-pressed:bg-[--hl-sm]",fullWidth:!0,confirmMessage:"",doneMessage:"",ariaLabel:"Delete Row",tabIndex:-1,disabled:m,onClick:()=>ee(t),children:e.jsx(w,{icon:"trash-can"})})]})]})};return e.jsxs("div",{className:"flex h-full min-w-max flex-col overflow-hidden",children:[e.jsxs(de,{className:"content-box z-10 flex h-[var(--line-height-sm)] flex-shrink-0 bg-[var(--color-bg)] text-[var(--font-size-sm)]",children:[e.jsxs(z,{className:"flex h-full items-center justify-center gap-2 px-4 py-1 text-xs text-[--color-font] ring-1 ring-transparent transition-all hover:bg-[--hl-xs] focus:ring-inset focus:ring-[--hl-md] aria-pressed:bg-[--hl-sm]","aria-label":"Add Row",isDisabled:m,onPress:()=>{Z()},children:[e.jsx(w,{icon:"plus"})," Add"]}),e.jsxs(q,{disabled:m||l.length===0,onClick:()=>{n([])},ariaLabel:"Delete All",className:"flex h-full items-center justify-center gap-2 px-4 py-1 text-xs text-[--color-font] ring-1 ring-transparent transition-all hover:bg-[--hl-xs] focus:ring-inset focus:ring-[--hl-md] aria-pressed:bg-[--hl-sm]",children:[e.jsx(w,{icon:"trash-can"}),e.jsx("span",{children:"Delete all"})]})]}),e.jsx(he,{"aria-label":"Environment Key Value Pair",selectionMode:"none",dragAndDropHooks:Y,dependencies:[f,s,b],className:"h-full w-full overflow-y-auto p-[--padding-sm]",items:l,children:r=>{const{id:t,name:i,enabled:o}=r;return e.jsx(xe,{id:t,textValue:`environment-item-${i||t}`,style:{opacity:o?"1":"0.4"},className:"flex h-[--line-height-sm] w-full focus:outline-none",children:J(r)},t)}}),e.jsx(me,{ref:y})]})};Ee.displayName="EnvironmentKeyValueEditor";export{je as E,Ee as a,Ve as h};
//# sourceMappingURL=key-value-editor-CPoqROww.js.map
