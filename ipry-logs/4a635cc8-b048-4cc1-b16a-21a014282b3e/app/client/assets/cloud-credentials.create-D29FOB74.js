import{h as f}from"./chunk-WY5IRSCW-1dc6FieG.js";import{c as a,cD as h}from"./index-BnTlsbFl.js";import{ao as g}from"./index-wZAP8gf2.js";import{i as o}from"./invariant-DVddvGrP.js";import{c as N}from"./router-BoVIwh1i.js";async function y({request:i}){const e=await i.json(),{name:n,provider:t,credentials:s,isAuthenticated:d}=e;if(o(n&&typeof n=="string","Name is required"),o(t,"Cloud Provider name is required"),o(s,"Credentials are required"),d){const r=await a.getByName(n,t);return r.length===0?await a.create(e):await a.update(r[0],e),s}const p=await g({pluginName:h,actionName:"authenticate",params:{provider:t,credentials:s}}),{success:m,error:c,result:u}=p;if(c)return{error:`${c.errorMessage}`};if(m){if(t==="hashicorp"){const{access_token:r,expires_at:l}=u;e.credentials.access_token=r,e.credentials.expires_at=l}return await a.create(e),u}return{error:"Unexpected response from "+t}}const P=N(i=>e=>i(JSON.stringify(e),{method:"POST",action:f("/cloud-credentials/create"),encType:"application/json"}));export{y as c,P as u};
//# sourceMappingURL=cloud-credentials.create-D29FOB74.js.map
