import{D as O,w as _,O as h,r as z}from"./chunk-OIYGIGL5-BYynBxW5.js";import{cH as j,w as m,cy as S,cI as V,cc as A,s as C,co as g,cJ as R,bd as D,z as L,b as W,B as G,c2 as E,aP as k,cK as N,c5 as w,cL as B,cM as x,aN as F}from"./index-BnTlsbFl.js";import{i as v}from"./invariant-DVddvGrP.js";const Q=_(h),H=r=>{const i=g(r);return F(r)||i?"webSocketResponse":k(r)?"socketIOResponse":B(r)?"mcpResponse":"response"};async function T({params:r}){const{organizationId:i,projectId:l,requestId:t,workspaceId:c}=r,s=await j(t);if(!s)throw z(`/organization/${i}/project/${l}/workspace/${c}/debug`);const d=await m.getByParentId(c);if(v(d,"Active workspace meta not found"),await m.updateByParentId(c,{activeRequestId:t}),S(t))return{activeRequest:s,activeRequestMeta:await V.updateOrCreateByParentId(t,{lastActive:Date.now()}),activeResponse:null,responses:[],requestVersions:[]};const o=await A.updateOrCreateByParentId(t,{lastActive:Date.now()});v(o,"Request meta not found");const{filterResponsesByEnv:P}=await C.get(),b=g(s),u=H(s),a=o.activeResponseId?await R[u].getById(o.activeResponseId):await R[u].getLatestForRequestId(t,d.activeEnvironmentId),q=await R[u].findByParentId(t),$=q.filter(e=>e.environmentId===d.activeEnvironmentId),p=(P?$:q).sort((e,n)=>e.created>n.created?-1:1);if(a&&"bodyPath"in a&&!(Math.max(a.bytesContent,a.bytesRead)>5*1024*1024)){const f=await D.getBodyBuffer(a);a.bodyBuffer=typeof f=="string"?Buffer.from(f):f}const y=await L.findByProjectId(l),M=await W.find(G.type,{parentId:{$in:y.map(e=>e._id)}}),I=y.map(e=>({...e,routes:M.filter(n=>n.parentId===e._id)}));if(b&&a&&!E(a))return{activeRequest:s,activeRequestMeta:o,activeResponse:null,responses:[],requestVersions:[],mockServerAndRoutes:I};if(k(s)){const e=await N.getOrCreateByParentId(t);return{activeRequest:s,activeRequestMeta:o,activeResponse:a,responses:p,requestVersions:await w.findByParentId(t),mockServerAndRoutes:I,requestPayload:e}}if(B(s)){const e=await x.getByParentIdAndUrl(t,s.url);return{activeRequest:s,activeRequestMeta:o,activeResponse:a,requestPayload:e,responses:p,requestVersions:await w.findByParentId(t)}}return{activeRequest:s,activeRequestMeta:o,activeResponse:a,responses:p,requestVersions:await w.findByParentId(t),mockServerAndRoutes:I}}function X(){return O("routes/organization.$organizationId.project.$projectId.workspace.$workspaceId.debug.request.$requestId")}export{T as c,Q as o,X as u};
//# sourceMappingURL=organization._organizationId.project._projectId.workspace._workspaceId.debug.request._requestId-CCT5t53Y.js.map
